{% extends "base.html" %}

{% block inline_javascript %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

<script>
const getCellValue = (tr, idx) => tr.children[idx].innerText || tr.children[idx].textContent;

const comparer = (idx, asc) => (a, b) => ((v1, v2) =>
    v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : v1.toString().localeCompare(v2)
    )(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));

// do the work...
document.querySelectorAll('th').forEach(th => th.addEventListener('click', (() => {
    const table = th.closest('table');
    Array.from(table.querySelectorAll('tr:nth-child(n+2)'))
        .sort(comparer(Array.from(th.parentNode.children).indexOf(th), this.asc = !this.asc))
        .forEach(tr => table.appendChild(tr) );
})));

</script>

{% endblock %}

{% block content %}
    <div class="row mb-3 mt-2">
        <div class="col-sm-3">
            <h2> Player Ranking </h2>
        </div>
    </div>

    <div class="row mb-3 mt-2">
        <div class="col-sm-3">
            <table>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Games Unplayed</th>
                    <th scope="col">Completed Weight</th>
                </tr>
                </tr>
                {% for user in users %}
                    <tr>
                        <th scope="row">{{ forloop.counter }} </th>
                        <td>
                            {% if request.user.is_staff %}
                                <a href="{% url 'admin:users_user_change' user.pk %}" class="hidden-link">
                                    {{ user.username|capfirst }}
                                </a>
                            {% else %}
                                {{ user.username|capfirst }}
                            {% endif %}
                        </td>
                        <td>
                            {{ user.number_unplayed_games }}
                            {{ user.status.symbol }}
                        </td>
                        <td>{{ user.completed_weight }}</td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>

    <div class="row mb-3 mt-2">
        <div class="col-sm-3">
            <h2> Latest Played Games </h2>
        </div>
    </div>

    <div class="row mb-3 mt-2">
        <div class="col-sm-3">
            <table>
                <tr>
                    <th scope="col">Day</th>
                    <th scope="col">Game</th>
                    <th scope="col">Whoe</th>
                </tr>
                </tr>
                    {% for played_day in recent_newly_played %}
                    <tr>
                        <td> {{ played_day.date_played }} </td>
                        <td> {{ played_day.board_game }} </td>
                        <td> {{ played_day.players }} </td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>
{% endblock %}
